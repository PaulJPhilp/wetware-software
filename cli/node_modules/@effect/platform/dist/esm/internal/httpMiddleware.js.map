{"version":3,"file":"httpMiddleware.js","names":["Context","Effect","FiberRef","constFalse","dual","globalValue","Layer","Option","Headers","ServerError","ServerRequest","ServerResponse","TraceContext","internalHttpApp","make","middleware","loggerDisabled","Symbol","for","unsafeMake","withLoggerDisabled","self","zipRight","set","currentTracerDisabledWhen","withTracerDisabledWhen","pred","locally","withTracerDisabledWhenEffect","withTracerDisabledForUrls","urls","req","includes","url","logger","httpApp","counter","withFiberRuntime","fiber","context","getFiberRef","currentContext","request","unsafeGet","HttpServerRequest","withLogSpan","flatMap","exit","_tag","response","cause","causeResponseStripped","annotateLogs","log","value","method","status","tracer","disabled","getOrUndefined","toURL","undefined","username","password","redactedHeaderNames","currentRedactedNames","redactedHeaders","redact","headers","useSpan","parent","fromHeaders","kind","captureStackTrace","span","attribute","toString","pathname","query","search","slice","protocol","name","String","remoteAddress","withParentSpan","exitResponse","xForwardedHeaders","updateService","modify","split","trim","searchParamsParser","params","searchParamsFromURL","URL","originalUrl","add","ParsedSearchParams","cors","options","opts","allowedOrigins","allowedMethods","allowedHeaders","exposedHeaders","credentials","isAllowedOrigin","origin","allowOrigin","originHeader","length","vary","allowMethods","join","allowCredentials","allowHeaders","accessControlRequestHeaders","exposeHeaders","maxAge","headersFromRequest","unsafeFromRecord","headersFromRequestOptions","preResponseHandler","succeed","setHeaders","empty","appendPreResponseHandler"],"sources":["../../../src/internal/httpMiddleware.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}